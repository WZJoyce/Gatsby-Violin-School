{"version":3,"file":"index.modern.js","sources":["../src/custom-properties.ts","../src/index.tsx"],"sourcesContent":["import { css, Theme, ColorModesScale, ColorMode } from '@theme-ui/css'\n\nconst toVarName = (key: string) => `--theme-ui-${key}`\nconst toVarValue = (key: string, value: string | number) =>\n  `var(${toVarName(key)}, ${value})`\n\nconst join = (...args: (string | undefined)[]) => args.filter(Boolean).join('-')\n\nconst numberScales = {\n  fontWeights: true,\n  lineHeights: true,\n}\nconst reservedKeys = {\n  useCustomProperties: true,\n  initialColorModeName: true,\n  initialColorMode: true,\n  useLocalStorage: true,\n}\n\nconst toPixel = (key: string, value: string | number) => {\n  if (typeof value !== 'number') return value\n  if (numberScales[key as keyof typeof numberScales]) return value\n  return value + 'px'\n}\n\n// convert theme values to custom properties\nexport const toCustomProperties = (\n  obj: Record<string, any> | undefined,\n  parent?: string,\n  themeKey?: string\n) => {\n  const next: Record<string, any> = Array.isArray(obj) ? [] : {}\n\n  for (let key in obj) {\n    const value = obj[key]\n    const name = join(parent, key)\n    if (value && typeof value === 'object') {\n      next[key] = toCustomProperties(value, name, key)\n      continue\n    }\n    if (reservedKeys[key as keyof typeof reservedKeys]) {\n      next[key] = value\n      continue\n    }\n    const val = toPixel(themeKey || key, value)\n    next[key] = toVarValue(name, val)\n  }\n\n  return next\n}\n\nexport const objectToVars = (parent: string, obj: Record<string, any>) => {\n  let vars: Record<string, object> = {}\n  for (let key in obj) {\n    if (key === 'modes') continue\n    const name = join(parent, key)\n    const value = obj[key]\n    if (value && typeof value === 'object') {\n      vars = {\n        ...vars,\n        ...objectToVars(name, value),\n      }\n    } else {\n      vars[toVarName(name)] = value\n    }\n  }\n  return vars\n}\n\n// create body styles for color modes\nexport const createColorStyles = (theme: Theme = {}) => {\n  if (!theme.colors || theme.useBodyStyles === false) return {}\n  if (theme.useCustomProperties === false || !theme.colors.modes) {\n    return css({\n      body: {\n        color: 'text',\n        bg: 'background',\n      },\n    })(theme)\n  }\n  const { colors } = theme\n  const modes = colors.modes || {}\n  const styles = objectToVars('colors', colors)\n\n  Object.keys(modes).forEach((mode) => {\n    const key = `&.theme-ui-${mode}`\n    styles[key] = objectToVars('colors', modes[mode])\n  })\n\n  return css({\n    body: {\n      ...styles,\n      color: 'text',\n      bg: 'background',\n    },\n  })(theme)\n}\n","import React from 'react'\nimport { jsx, useThemeUI, merge, Context } from '@theme-ui/core'\nimport { get, Theme } from '@theme-ui/css'\nimport { Global, ThemeContext as EmotionContext } from '@emotion/core'\nimport { toCustomProperties, createColorStyles } from './custom-properties'\n\nconst STORAGE_KEY = 'theme-ui-color-mode'\n\ndeclare module '@theme-ui/core' {\n  export interface ContextValue {\n    colorMode?: string\n    setColorMode?: (mode: string) => void\n  }\n}\n\nconst storage = {\n  get: (init?: string) => {\n    try {\n      return window.localStorage.getItem(STORAGE_KEY) || init\n    } catch (e) {\n      console.warn(\n        'localStorage is disabled and color mode might not work as expected.',\n        'Please check your Site Settings.',\n        e\n      )\n    }\n  },\n  set: (value: string) => {\n    try {\n      window.localStorage.setItem(STORAGE_KEY, value)\n    } catch (e) {\n      console.warn(\n        'localStorage is disabled and color mode might not work as expected.',\n        'Please check your Site Settings.',\n        e\n      )\n    }\n  },\n}\n\nconst getMediaQuery = () => {\n  const darkQuery = '(prefers-color-scheme: dark)'\n  const lightQuery = '(prefers-color-scheme: light)'\n  const darkMQL = window.matchMedia\n    ? window.matchMedia(darkQuery)\n    : { media: false }\n  const lightMQL = window.matchMedia\n    ? window.matchMedia(lightQuery)\n    : { media: false }\n  const dark = darkMQL.media === darkQuery && darkMQL.matches\n  if (dark) return 'dark'\n  const light = lightMQL.media === lightQuery && lightMQL.matches\n  if (light) return 'light'\n  return 'default'\n}\n\nconst useColorModeState = (\n  theme: Theme = {}\n): [string, React.Dispatch<React.SetStateAction<string>>] => {\n  const [mode, setMode] = React.useState(\n    theme.initialColorModeName || 'default'\n  )\n\n  // initialize state\n  React.useEffect(() => {\n    const stored = theme.useLocalStorage !== false && storage.get()\n    document.body.classList.remove('theme-ui-' + stored)\n    if (!stored && theme.useColorSchemeMediaQuery) {\n      const query = getMediaQuery()\n      setMode(query)\n      return\n    }\n    if (!stored || stored === mode) return\n    setMode(stored)\n  }, [])\n\n  React.useEffect(() => {\n    if (!mode || theme.useLocalStorage === false) return\n    storage.set(mode)\n  }, [mode])\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (\n      theme.colors &&\n      theme.colors.modes &&\n      theme.initialColorModeName &&\n      Object.keys(theme.colors.modes).indexOf(theme.initialColorModeName) > -1\n    ) {\n      console.warn(\n        'The `initialColorModeName` value should be a unique name' +\n          ' and cannot reference a key in `theme.colors.modes`.'\n      )\n    }\n  }\n\n  return [mode, setMode]\n}\n\nexport const useColorMode = (): [\n  string | undefined,\n  (mode: string) => void\n] => {\n  const { colorMode, setColorMode } = useThemeUI()\n\n  if (typeof setColorMode !== 'function') {\n    throw new Error(`[useColorMode] requires the ColorModeProvider component`)\n  }\n\n  return [colorMode, setColorMode]\n}\n\nconst applyColorMode = (theme: Theme, mode: string): Theme => {\n  if (!mode) return theme\n  const modes = get(theme, 'colors.modes', {})\n  return merge.all({}, theme, {\n    colors: get(modes, mode, {}),\n  })\n}\n\nconst BodyStyles = () =>\n  jsx(Global, {\n    styles: (theme) => createColorStyles(theme as Theme),\n  })\n\nexport const ColorModeProvider: React.FC = ({ children }) => {\n  const outer = useThemeUI()\n  const [colorMode, setColorMode] = useColorModeState(outer.theme)\n  const theme = applyColorMode(outer.theme || {}, colorMode)\n  const emotionTheme = { ...theme }\n\n  if (theme.useCustomProperties !== false) {\n    emotionTheme.colors = toCustomProperties(emotionTheme.colors, 'colors')\n  }\n\n  const context = {\n    ...outer,\n    theme,\n    colorMode,\n    setColorMode,\n  }\n\n  return jsx(\n    EmotionContext.Provider,\n    { value: emotionTheme },\n    jsx(\n      Context.Provider,\n      { value: context },\n      jsx(BodyStyles, { key: 'color-mode' }),\n      children\n    )\n  )\n}\n\nconst noflash = `(function() { try {\n  var mode = localStorage.getItem('theme-ui-color-mode');\n  if (!mode) return\n  document.body.classList.add('theme-ui-' + mode);\n} catch (e) {} })();`\n\nexport const InitializeColorMode = () =>\n  jsx('script', {\n    key: 'theme-ui-no-flash',\n    dangerouslySetInnerHTML: {\n      __html: noflash,\n    },\n  })\n"],"names":["toVarName","key","toVarValue","value","join","args","filter","Boolean","numberScales","fontWeights","lineHeights","reservedKeys","useCustomProperties","initialColorModeName","initialColorMode","useLocalStorage","toPixel","toCustomProperties","obj","parent","themeKey","next","Array","isArray","name","val","objectToVars","vars","createColorStyles","theme","colors","useBodyStyles","modes","css","body","color","bg","styles","Object","keys","forEach","mode","STORAGE_KEY","storage","get","init","window","localStorage","getItem","e","console","warn","set","setItem","getMediaQuery","darkQuery","lightQuery","darkMQL","matchMedia","media","lightMQL","dark","matches","light","useColorModeState","setMode","React","useState","useEffect","stored","document","classList","remove","useColorSchemeMediaQuery","query","process","env","NODE_ENV","indexOf","useColorMode","colorMode","setColorMode","useThemeUI","Error","applyColorMode","merge","all","BodyStyles","jsx","Global","ColorModeProvider","children","outer","emotionTheme","context","EmotionContext","Provider","Context","noflash","InitializeColorMode","dangerouslySetInnerHTML","__html"],"mappings":"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"}